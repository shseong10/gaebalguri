<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        " http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.icia.seong.dao.InventoryDao">
    <!-- 상품 등록 -->
    <insert id="addItemSelectKey" parameterType="InventoryDto" useGeneratedKeys="true" keyProperty="h_p_num">
        insert into h_product (h_p_name, h_p_category, h_p_price, h_p_quantity, h_p_desc, h_p_date)
        values (#{h_p_name}, default, #{h_p_price}, #{h_p_quantity}, #{h_p_desc}, default)
        <selectKey keyProperty="h_p_num" resultType="Integer" order="AFTER">
            select last_insert_id()
        </selectKey>
    </insert>
    <!-- 상품 이미지 첨부 -->
    <insert id="fileInsertMap" parameterType="HashMap">
        insert into h_p_image
        values(null, #{h_p_num}, #{oriFileName},#{sysFileName})
    </insert>
    <!-- 목록 출력 -->
    <resultMap type="InventoryDto" id="ifList">
        <id property="h_p_num" column="h_p_num" />
        <result property="h_p_name" column="h_p_name" />
        <result property="h_p_price" column="h_p_price" />
        <result property="h_p_desc" column="h_p_desc" />
        <collection property="ifList" javaType="ArrayList" ofType="InventoryFile">
            <result property="h_p_oriFileName" column="h_p_oriFileName" />
            <result property="h_p_sysFileName" column="h_p_sysfilename" />
        </collection>
    </resultMap>
    <select id="getInventoryList" parameterType="HashMap" resultMap="ifList" resultType="InventoryDto">
        select h_p_num, h_p_name, h_p_price, h_p_desc,
        h_p_orifilename, h_p_sysfilename
        from h_product left join h_p_image
        on h_p_num=h_p_pnum order by h_p_num desc
    </select>
</mapper>